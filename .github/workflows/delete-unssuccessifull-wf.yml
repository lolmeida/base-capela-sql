name: Cleanup Failed and Cancelled Workflows
on:
  schedule:
    - cron: '0 0 * * *' # Runs daily at midnight UTC

  workflow_dispatch: {} # Allows manual triggering

jobs:
  cleanup:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

#      - name: Set up GitHub CLI
#        uses: actions/checkout@v4

#      - name: Install the gh cli
#        uses: ksivamuthu/actions-setup-gh-cli@v3
#        with:
#          version: 2.24.3
#      - run: |
#          gh version

      - name: Delete all failed workflows
        run: |
          gh run list --repo ${{ github.repository }} --status failure --json databaseId --jq '.[].databaseId' | xargs -I {} gh run delete {}

      - name: Delete all cancelled workflows
        run: |
          gh run list --repo ${{ github.repository }} --status cancelled --json databaseId --jq '.[].databaseId' | xargs -I {} gh run delete {}